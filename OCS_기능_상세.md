# OCS (Order Communication System) - 처방전달시스템 기능 상세

## 📋 OCS란?

**OCS (Order Communication System)**는 병원에서 의사가 처방전, 검사, 영상촬영을 주문하고 각 부서로 자동 전달하는 시스템입니다.

---

## 🎯 핵심 기능

### 1. 주문 생성 및 관리

#### 1.1 처방전 주문
- **기능**: 의사가 환자에게 처방할 약물을 주문
- **입력 정보**:
  - 약물명, 용량, 용법, 복용 기간
  - 우선순위 (일반/긴급/즉시/응급)
  - 완료 기한
  - 메모
- **전달 대상**: 약국 (pharmacy)
- **예시**: "아스피린 100mg, 1일 1회, 7일간"

#### 1.2 검사 주문
- **기능**: 의사가 환자에게 필요한 검사를 주문
- **입력 정보**:
  - 검사 항목 (혈액검사, 소변검사, CT 등)
  - 각 검사별 우선순위
  - 완료 기한
- **전달 대상**: 검사실 (lab)
- **예시**: "혈액검사, 소변검사"

#### 1.3 영상촬영 의뢰
- **기능**: 의사가 환자에게 필요한 영상 촬영을 의뢰
- **입력 정보**:
  - 촬영 유형 (MRI, CT, X-RAY, 초음파)
  - 촬영 부위 (유방, 폐, 뇌 등)
  - 조영제 사용 여부
  - 우선순위
  - 완료 기한
- **전달 대상**: 방사선과 (radiology)
- **예시**: "유방 MRI, 조영제 사용"

---

### 2. 자동 검증 시스템 ⚠️

#### 2.1 약물 상호작용 체크
- **기능**: 처방전 생성 시 자동으로 약물 간 상호작용 검사
- **검사 내용**:
  - 두 약물을 함께 복용할 때 위험한 조합 확인
  - 심각도 분류 (경미/중등도/심각)
- **결과**:
  - 심각한 상호작용 발견 시: 주문 전달 불가 ❌
  - 경미/중등도 상호작용: 경고 표시 ⚠️
- **예시**: 
  - "와파린 + 아스피린: 출혈 위험 증가 (심각)"
  - "디곡신 + 푸로세미드: 디곡신 독성 위험 (중등도)"

#### 2.2 알레르기 체크
- **기능**: 환자의 알레르기 정보와 주문 항목 비교
- **검사 내용**:
  - 처방약물이 환자 알레르기 항목과 겹치는지 확인
  - 검사 항목 중 조영제 사용 시 요오드 알레르기 확인
- **결과**:
  - 알레르기 위험 발견 시: 주문 전달 불가 ❌
  - 경고 메시지 표시
- **예시**:
  - "페니실린 알레르기 환자에게 페니실린 처방 시도 → 차단"
  - "요오드 알레르기 환자에게 조영제 사용 검사 → 차단"

#### 2.3 주문 검증 결과
- **검증 통과**: ✅ 주문 전달 가능
- **검증 실패**: ❌ 주문 전달 불가, 검증 메모 표시

---

### 3. 우선순위 관리 🚨

#### 우선순위 레벨
1. **응급 (emergency)**: 즉시 처리 필요, 최우선
2. **즉시 (stat)**: 빠른 처리 필요
3. **긴급 (urgent)**: 우선 처리
4. **일반 (routine)**: 일반 순서대로 처리

#### 우선순위별 표시
- 배지 색상으로 구분 (빨강 → 주황 → 회색)
- 목록에서 우선순위 순으로 정렬
- 통계에서 긴급 주문 개수 표시

---

### 4. 주문 상태 관리 📊

#### 상태 흐름
```
대기중 (pending)
  ↓ [의사: 전달 버튼 클릭]
전달됨 (sent)
  ↓ [부서: 처리 시작 버튼 클릭]
처리중 (processing)
  ↓ [부서: 완료 처리 버튼 클릭]
완료 (completed)
```

또는

```
대기중 (pending)
  ↓ [의사/원무과: 취소]
취소 (cancelled)
```

#### 상태별 기능
- **대기중**: 검증 완료 후 전달 가능
- **전달됨**: 부서에서 처리 시작 가능
- **처리중**: 부서에서 작업 중
- **완료**: 모든 처리가 끝남
- **취소**: 주문이 취소됨

---

### 5. 역할별 기능 분리 👥

#### 5.1 의사 (호흡기내과, 외과, 영상의학과 등)
- ✅ 주문 생성 (처방전/검사/영상촬영)
- ✅ 자신이 생성한 주문 조회
- ✅ 주문 전달 (검증 통과 후)
- ✅ 주문 취소
- ✅ 환자별 주문 이력 확인

**보이는 주문**: 자신이 생성한 주문만

#### 5.2 방사선과/영상의학과
- ✅ 영상 촬영 주문 조회 (자동 필터링)
- ✅ 주문 처리 시작
- ✅ 촬영 완료 처리
- ❌ 주문 생성 불가 (의사만 가능)

**보이는 주문**: 영상촬영 주문만 (`target_department='radiology'`, `order_type='imaging'`)

#### 5.3 검사실 (LIS 연동 예정)
- ✅ 검사 주문 조회
- ✅ 주문 처리 시작
- ✅ 검사 완료 처리
- ❌ 주문 생성 불가

**보이는 주문**: 검사 주문만 (`target_department='lab'`, `order_type='lab_test'`)

#### 5.4 약국 (추후 연동)
- ✅ 처방전 조회
- ✅ 조제 완료 처리
- ❌ 주문 생성 불가

**보이는 주문**: 처방전만 (`target_department='pharmacy'`, `order_type='prescription'`)

#### 5.5 원무과
- ✅ 모든 주문 조회 (필터링 없음)
- ✅ 주문 통계 확인
- ✅ 주문 취소 (관리 목적)
- ❌ 주문 생성 불가 (의사만 가능)

**보이는 주문**: 모든 주문

---

### 6. 주문 이력 추적 📝

#### 6.1 상태 변경 이력
- 주문 상태가 변경될 때마다 기록
- 변경자 정보 저장
- 변경 메모 저장
- 변경 일시 기록

**예시**:
```
2025-01-20 10:00 - 상태 변경: 대기중 → 전달됨 (의사: 김의사)
2025-01-20 10:30 - 상태 변경: 전달됨 → 처리중 (방사선과: 이기사)
2025-01-20 11:00 - 상태 변경: 처리중 → 완료 (방사선과: 이기사)
```

#### 6.2 검증 이력
- 약물 상호작용 검사 결과 저장
- 알레르기 검사 결과 저장
- 검사 일시 및 검사자 기록

---

### 7. 통계 및 대시보드 📈

#### 7.1 실시간 통계
- 오늘 생성된 주문 수
- 상태별 주문 개수 (대기중/전달됨/처리중/완료)
- 우선순위별 주문 개수
- 긴급 주문 개수
- 검증 실패 주문 개수

#### 7.2 주문 유형별 통계
- 처방전 주문 수
- 검사 주문 수
- 영상촬영 주문 수

---

### 8. 검색 및 필터링 🔍

#### 8.1 검색 기능
- 환자명으로 검색
- 환자번호로 검색
- 의사명으로 검색

#### 8.2 필터링 기능
- 상태별 필터 (대기중/전달됨/처리중/완료/취소)
- 주문 유형별 필터 (처방전/검사/영상촬영)
- 우선순위별 필터
- 뷰 모드 (전체/내 주문/대기 중인 주문)

---

### 9. 알림 및 경고 ⚠️

#### 9.1 검증 실패 경고
- 약물 상호작용 경고 (빨간색 배지)
- 알레르기 위험 경고 (빨간색 배지)
- 검증 메모 표시

#### 9.2 우선순위 알림
- 긴급 주문 강조 표시
- 응급 주문 최우선 표시

---

## 🔄 전체 워크플로우

### 시나리오 1: 처방전 주문
```
1. 의사가 환자 진료 후 처방전 주문 생성
   ↓
2. 시스템이 자동으로 약물 상호작용 체크
   ↓
3. 시스템이 자동으로 알레르기 체크
   ↓
4. 검증 통과 → 의사가 "전달" 버튼 클릭
   ↓
5. 약국으로 주문 전달됨 (상태: 전달됨)
   ↓
6. 약국에서 조제 시작 (상태: 처리중)
   ↓
7. 약국에서 조제 완료 (상태: 완료)
```

### 시나리오 2: 영상촬영 의뢰
```
1. 의사가 환자 진료 후 영상촬영 의뢰 생성
   ↓
2. 시스템이 자동으로 알레르기 체크 (조영제 사용 시)
   ↓
3. 검증 통과 → 의사가 "전달" 버튼 클릭
   ↓
4. 방사선과로 주문 전달됨 (상태: 전달됨)
   ↓
5. 방사선과에서 촬영 스케줄 확인 (상태: 처리중)
   ↓
6. 촬영 완료 (상태: 완료)
   ↓
7. (추후 RIS 연동 시) 촬영 결과 자동 연결
```

### 시나리오 3: 검사 주문
```
1. 의사가 환자 진료 후 검사 주문 생성
   ↓
2. 시스템이 자동으로 알레르기 체크
   ↓
3. 검증 통과 → 의사가 "전달" 버튼 클릭
   ↓
4. 검사실로 주문 전달됨 (상태: 전달됨)
   ↓
5. 검사실에서 검사 수행 (상태: 처리중)
   ↓
6. 검사 완료 (상태: 완료)
   ↓
7. (추후 LIS 연동 시) 검사 결과 자동 연결
```

---

## 🎯 OCS의 핵심 가치

### 1. 환자 안전
- 약물 상호작용 자동 체크로 의료 사고 예방
- 알레르기 자동 체크로 알레르기 반응 예방

### 2. 효율성
- 의사가 직접 부서에 가지 않고도 주문 전달
- 디지털화로 종이 처방전 불필요
- 실시간 상태 확인

### 3. 추적 가능성
- 모든 주문의 상태 변경 이력 기록
- 검증 이력 보관
- 감사 추적 가능

### 4. 역할 분리
- 각 부서가 자신의 업무에만 집중
- 자동 필터링으로 불필요한 정보 차단

---

## 📌 요약

**OCS는 병원에서 의사가 처방전, 검사, 영상촬영을 주문하고 각 부서로 자동 전달하는 시스템입니다.**

**주요 기능:**
1. ✅ 주문 생성 (처방전/검사/영상촬영)
2. ✅ 자동 검증 (약물 상호작용, 알레르기)
3. ✅ 우선순위 관리
4. ✅ 상태 관리 및 추적
5. ✅ 역할별 자동 필터링
6. ✅ 통계 및 대시보드
7. ✅ 검색 및 필터링

**결과:**
- 환자 안전 향상
- 업무 효율성 증대
- 추적 가능성 확보
- 역할별 업무 분리
